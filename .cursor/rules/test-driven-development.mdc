---
description: Social Script ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ã«é–¢ã™ã‚‹åŒ…æ‹¬çš„ãªã‚¬ã‚¤ãƒ‰
globs: ["spec/**/*_spec.rb", "test/**/*_test.rb", "**/*_test.rb", "**/*_spec.rb"]
---

# ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰æ¨™æº–

<rule>
name: test_driven_development
description: Social Script ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã®ãƒ«ãƒ¼ãƒ«ã¨æ¨™æº–
filters:
  - type: file_extension
    pattern: "\\.(rb)$"
  - type: directory
    pattern: "(spec|test)"
actions:
  - type: suggest
    message: |
      ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³:

      ## 1. TDD ã‚µã‚¤ã‚¯ãƒ«

      ### 1.1 ãƒ¬ãƒƒãƒ‰ãƒ»ã‚°ãƒªãƒ¼ãƒ³ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã‚µã‚¤ã‚¯ãƒ«
      ```
      ğŸ”´ ãƒ¬ãƒƒãƒ‰: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
      ğŸŸ¢ ã‚°ãƒªãƒ¼ãƒ³: ãƒ†ã‚¹ãƒˆã‚’é€šã™ãŸã‚ã®æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
      ğŸ”µ ãƒªãƒ•ã‚¡ã‚¯ã‚¿: ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ã™ã‚‹
      ```

      ### 1.2 è©³ç´°ãªã‚¹ãƒ†ãƒƒãƒ—
      1. **ãƒ¬ãƒƒãƒ‰**: æ–°ã—ã„æ©Ÿèƒ½ã®å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
      2. **ã‚°ãƒªãƒ¼ãƒ³**: ãƒ†ã‚¹ãƒˆã‚’é€šã™ãŸã‚ã®æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
      3. **ãƒªãƒ•ã‚¡ã‚¯ã‚¿**: ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ã—ã€é‡è¤‡ã‚’é™¤å»ã™ã‚‹
      4. **ç¹°ã‚Šè¿”ã—**: æ¬¡ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ç¹°ã‚Šè¿”ã™

      ## 2. ãƒ†ã‚¹ãƒˆæ§‹é€ 

      ### 2.1 RSpec ã®åŸºæœ¬æ§‹é€ 
      ```ruby
      # spec/models/user_spec.rb
      require 'rails_helper'

      RSpec.describe User, type: :model do
        describe '#full_name' do
          context 'when first_name and last_name are present' do
            it 'returns the full name' do
              user = User.new(first_name: 'John', last_name: 'Doe')
              expect(user.full_name).to eq('John Doe')
            end
          end

          context 'when only first_name is present' do
            it 'returns the first name' do
              user = User.new(first_name: 'John')
              expect(user.full_name).to eq('John')
            end
          end
        end
      end
      ```

      ### 2.2 ãƒ†ã‚¹ãƒˆã®çµ„ç¹”
      ```ruby
      # è‰¯ã„ãƒ†ã‚¹ãƒˆæ§‹é€ 
      RSpec.describe SomeClass do
        # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        let(:user) { create(:user) }
        
        # ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—
        describe '#method_name' do
          context 'when condition is true' do
            it 'returns expected result' do
              # ãƒ†ã‚¹ãƒˆå†…å®¹
            end
          end
        end
      end
      ```

      ## 3. ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ—

      ### 3.1 å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆUnit Testsï¼‰
      ```ruby
      # spec/models/user_spec.rb
      RSpec.describe User, type: :model do
        describe 'validations' do
          it { should validate_presence_of(:email) }
          it { should validate_uniqueness_of(:email) }
        end

        describe 'associations' do
          it { should have_many(:posts) }
        end

        describe '#active?' do
          it 'returns true when user is active' do
            user = build(:user, active: true)
            expect(user.active?).to be true
          end
        end
      end
      ```

      ### 3.2 çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆIntegration Testsï¼‰
      ```ruby
      # spec/requests/users_spec.rb
      RSpec.describe 'Users', type: :request do
        describe 'GET /users' do
          it 'returns a successful response' do
            get users_path
            expect(response).to have_http_status(:ok)
          end
        end

        describe 'POST /users' do
          context 'with valid parameters' do
            it 'creates a new user' do
              expect {
                post users_path, params: { user: { name: 'John', email: 'john@example.com' } }
              }.to change(User, :count).by(1)
            end
          end
        end
      end
      ```

      ### 3.3 ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆï¼ˆSystem Testsï¼‰
      ```ruby
      # spec/system/user_registration_spec.rb
      RSpec.describe 'User Registration', type: :system do
        it 'allows a user to register' do
          visit new_user_registration_path
          
          fill_in 'Name', with: 'John Doe'
          fill_in 'Email', with: 'john@example.com'
          fill_in 'Password', with: 'password123'
          
          click_button 'Register'
          
          expect(page).to have_content('Welcome, John!')
        end
      end
      ```

      ## 4. ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã®ä½¿ç”¨

      ### 4.1 FactoryBot è¨­å®š
      ```ruby
      # spec/factories/users.rb
      FactoryBot.define do
        factory :user do
          name { 'John Doe' }
          email { 'john@example.com' }
          password { 'password123' }
          
          trait :admin do
            role { 'admin' }
          end
          
          trait :inactive do
            active { false }
          end
        end
      end
      ```

      ### 4.2 ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã®ä½¿ç”¨
      ```ruby
      # ãƒ†ã‚¹ãƒˆã§ã®ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ä½¿ç”¨
      describe '#some_method' do
        let(:user) { create(:user) }
        let(:admin_user) { create(:user, :admin) }
        
        it 'works with regular user' do
          expect(user.some_method).to eq(expected_value)
        end
      end
      ```

      ## 5. ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–

      ### 5.1 ã‚¹ã‚¿ãƒ–ã®ä½¿ç”¨
      ```ruby
      # å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¹ã‚¿ãƒ–
      describe '#fetch_data' do
        it 'returns parsed data' do
          allow(ExternalService).to receive(:fetch).and_return('raw_data')
          allow(DataParser).to receive(:parse).with('raw_data').and_return('parsed_data')
          
          result = subject.fetch_data
          expect(result).to eq('parsed_data')
        end
      end
      ```

      ### 5.2 ãƒ¢ãƒƒã‚¯ã®ä½¿ç”¨
      ```ruby
      # ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã®ç¢ºèª
      describe '#process_data' do
        it 'calls the external service' do
          expect(ExternalService).to receive(:process).with('data')
          subject.process_data('data')
        end
      end
      ```

      ## 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ

      ### 6.1 ä¾‹å¤–ã®ãƒ†ã‚¹ãƒˆ
      ```ruby
      describe '#risky_operation' do
        context 'when something goes wrong' do
          it 'raises an error' do
            allow(DependentService).to receive(:call).and_raise(StandardError)
            
            expect {
              subject.risky_operation
            }.to raise_error(StandardError)
          end
        end
      end
      ```

      ### 6.2 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
      ```ruby
      describe 'validations' do
        it 'is invalid without an email' do
          user = build(:user, email: nil)
          expect(user).not_to be_valid
          expect(user.errors[:email]).to include("can't be blank")
        end
      end
      ```

      ## 7. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

      ### 7.1 å®Ÿè¡Œæ™‚é–“ã®ãƒ†ã‚¹ãƒˆ
      ```ruby
      describe '#expensive_operation' do
        it 'completes within acceptable time' do
          expect {
            subject.expensive_operation
          }.to perform_under(1.second)
        end
      end
      ```

      ### 7.2 ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ãƒ†ã‚¹ãƒˆ
      ```ruby
      describe '#memory_intensive_operation' do
        it 'does not consume excessive memory' do
          expect {
            subject.memory_intensive_operation
          }.not_to exceed_memory_limit(100.megabytes)
        end
      end
      ```

      ## 8. ãƒ†ã‚¹ãƒˆã®æ•´ç†ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

      ### 8.1 ãƒ†ã‚¹ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
      ```ruby
      # æ©Ÿèƒ½ã”ã¨ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
      RSpec.describe User do
        describe 'authentication' do
          # èªè¨¼é–¢é€£ã®ãƒ†ã‚¹ãƒˆ
        end
        
        describe 'profile management' do
          # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«é–¢é€£ã®ãƒ†ã‚¹ãƒˆ
        end
        
        describe 'permissions' do
          # æ¨©é™é–¢é€£ã®ãƒ†ã‚¹ãƒˆ
        end
      end
      ```

      ### 8.2 å…±é€šã®è¨­å®š
      ```ruby
      # spec/support/shared_examples.rb
      RSpec.shared_examples 'an authenticatable resource' do
        it 'requires authentication' do
          expect(response).to have_http_status(:unauthorized)
        end
      end

      # ãƒ†ã‚¹ãƒˆã§ã®ä½¿ç”¨
      RSpec.describe 'Protected Resource' do
        include_examples 'an authenticatable resource'
      end
      ```

      ## 9. ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç›£è¦–

      ### 9.1 SimpleCov è¨­å®š
      ```ruby
      # spec/rails_helper.rb
      require 'simplecov'
      SimpleCov.start 'rails' do
        add_filter '/spec/'
        add_filter '/config/'
        add_filter '/vendor/'
        
        minimum_coverage 90
      end
      ```

      ### 9.2 ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèª
      ```bash
      # ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
      bundle exec rspec
      open coverage/index.html
      ```

      ## 10. ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

      ### 10.1 CI ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
      ```yaml
      # .github/workflows/test.yml
      name: Test
      on: [push, pull_request]
      jobs:
        test:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v2
            - name: Setup Ruby
              uses: ruby/setup-ruby@v1
              with:
                ruby-version: 3.2
            - name: Run tests
              run: bundle exec rspec
      ```

      ### 10.2 ãƒ†ã‚¹ãƒˆçµæœã®å ±å‘Š
      ```bash
      # è©³ç´°ãªãƒ†ã‚¹ãƒˆçµæœã®å‡ºåŠ›
      bundle exec rspec --format documentation
      ```

      ## 11. TDD ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

      ### 11.1 ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
      - å®Ÿè£…å‰ã«å¿…ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ã
      - ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      - æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã§í…ŒìŠ¤íŠ¸ã‚’é€šã™

      ### 11.2 ãƒ†ã‚¹ãƒˆã®å“è³ª
      - èª­ã¿ã‚„ã™ãç†è§£ã—ã‚„ã™ã„ãƒ†ã‚¹ãƒˆ
      - 1ã¤ã®ãƒ†ã‚¹ãƒˆã§1ã¤ã®æ¦‚å¿µã‚’ãƒ†ã‚¹ãƒˆ
      - é©åˆ‡ãªåå‰ä»˜ã‘
      - DRY åŸå‰‡ã®é©ç”¨

      ### 11.3 ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
      - ãƒ†ã‚¹ãƒˆãŒé€šã£ãŸå¾Œã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
      - ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’é™¤å»
      - å¯èª­æ€§ã®å‘ä¸Š
      - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–

examples:
  - input: |
      "æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹"
    output: |
      ```ruby
      # 1. ã¾ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆãƒ¬ãƒƒãƒ‰ï¼‰
      # spec/models/user_spec.rb
      RSpec.describe User do
        describe '#full_name' do
          it 'returns the full name' do
            user = User.new(first_name: 'John', last_name: 'Doe')
            expect(user.full_name).to eq('John Doe')
          end
        end
      end
      
      # 2. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
      # 3. æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã§å®Ÿè£…ï¼ˆã‚°ãƒªãƒ¼ãƒ³ï¼‰
      # app/models/user.rb
      class User < ApplicationRecord
        def full_name
          "#{first_name} #{last_name}"
        end
      end
      
      # 4. ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèª
      # 5. å¿…è¦ã«å¿œã˜ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
      ```

metadata:
  priority: critical
  version: 1.0
  dependencies:
    - rspec-rails
    - factory_bot_rails
    - simplecov
  tags:
    - tdd
    - testing
    - rspec
    - quality
</rule>

---